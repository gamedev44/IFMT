<!-- index.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Image Forensics Multi-Tool Main Index" />
  <meta name="keywords" content="Image Forensics, Photo Analysis, UFO Detection, Digital Alteration" />
  <meta name="author" content="Risk" />
  <title>Image Forensics Multi-Tool v2 [Alpha]</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    body {
      font-family: Arial, sans-serif;
      background-color: #f4f4f9;
      display: flex;
      min-height: 100vh;
      width: 100%;
    }
    header {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      background-color: #222;
      color: #fff;
      padding: 10px;
      text-align: center;
      z-index: 999;
    }
    .sidebar {
      margin-top: 60px; 
      width: 250px;
      background-color: #333;
      color: #fff;
      flex-shrink: 0;
    }
    .sidebar h2 {
      text-align: center;
      padding: 15px 0;
      border-bottom: 1px solid #444;
      margin-bottom: 10px;
      background-color: #222;
    }
    .sidebar .controls {
      text-align: center;
      padding: 10px;
      border-bottom: 1px solid #444;
    }
    .sidebar ul {
      list-style-type: none;
      padding: 0;
    }
    /* Tooltip container */
    .tooltip {
      position: relative;
      display: block;
    }
    .tooltip a {
      display: block;
      padding: 10px 20px;
      color: #fff;
      text-decoration: none;
      border-bottom: 1px solid #444;
      cursor: pointer;
    }
    .tooltip a:hover {
      background-color: #444;
    }
    /* Tooltip text */
    .tooltip .tooltiptext {
      visibility: hidden;
      width: 250px;
      background-color: #222;
      color: #fff;
      text-align: left;
      padding: 8px;
      border-radius: 4px;
      position: absolute;
      z-index: 1000;
      top: 50%;
      left: 105%;
      transform: translateY(-50%);
      opacity: 0;
      transition: opacity 0.3s;
      border: 1px solid #444;
      font-size: 0.85rem;
    }
    .tooltip:hover .tooltiptext {
      visibility: visible;
      opacity: 1;
    }
    .main {
      margin-top: 60px; 
      flex: 1;
      display: flex;
      flex-direction: column;
    }
    #toolFrame {
      width: 100%;
      height: 0;
      border: 0;
      transition: height 0.3s ease;
      overflow: auto;
    }
    #diagramFrame {
      width: 100%;
      height: 100%;
      border: 0;
      transition: height 0.3s ease;
      overflow: auto;
    }
    .context-menu {
      position: absolute;
      background-color: #222;
      color: #fff;
      border: 1px solid #444;
      display: none;
      z-index: 1000;
    }
    .context-menu ul {
      list-style: none;
      margin: 0;
      padding: 5px 0;
    }
    .context-menu ul li {
      padding: 5px 15px;
      cursor: pointer;
    }
    .context-menu ul li:hover {
      background-color: #444;
    }
    /* Responsive layout for smaller screens */
    @media (max-width: 768px) {
      body {
        flex-direction: column;
      }
      .sidebar {
        width: 100%;
        margin-top: 110px;
      }
      .main {
        margin-top: 0;
        flex: unset;
        height: calc(100vh - 110px);
      }
      #toolFrame {
        height: 0;
      }
      #diagramFrame {
        height: 100%;
      }
    }
    /* Intro Modal - Discord-like styling */
    .modal-overlay {
      display: block;
      position: fixed;
      z-index: 9999;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.5);
    }
    .modal-content {
      background-color: #36393f; /* Discord dark gray */
      color: #dcddde; /* Slight off-white text */
      margin: 80px auto;
      padding: 20px;
      width: 90%;
      max-width: 600px;
      border-radius: 6px;
      position: relative;
      text-align: left;
      box-shadow: 2px 4px 12px rgba(0,0,0,0.8); /* offset drop shadow */
    }
    .modal-close {
      position: absolute;
      top: 10px;
      right: 15px;
      font-size: 20px;
      font-weight: bold;
      cursor: pointer;
      background: none;
      border: none;
      color: #dcddde;
    }
    .modal-header {
      font-size: 1.2em;
      margin-bottom: 10px;
    }
    .modal-body {
      line-height: 1.4em;
    }
    .modal-body p {
      margin: 0.5em 0;
    }
    .modal-button {
      margin-top: 15px;
      background-color: #b5b517;
      color: #2c2f33;
      border: none;
      border-radius: 5px;
      padding: 8px 15px;
      cursor: pointer;
      transition: background-color 0.2s ease;
    }
    .modal-button:hover {
      background-color: #353511;
    }
  </style>
</head>
<body>
  <!-- Intro Modal -->
  <div id="introModal" class="modal-overlay">
    <div class="modal-content">
      <button id="closeIntro" class="modal-close">&times;</button>
      <div class="modal-header">⚠️Alpha Development Notice⚠️</div>
      <div class="modal-body">
        <p>This Image Forensics Multi-Tool is still in a very early alpha phase. It's being programmed and tested by a single developer, so updates and improvements may take time.</p>
        <p>Each tool is modular, meaning you can load them as separate HTML pages via iframes. Feel free to suggest or create new modules—just let us know and we'll integrate them easily.</p>
        <p>Note that each button on the left has a brief tooltip explaining how it works and which sliders it offers. Please explore responsibly and share any feedback you have!</p>
      </div>
      <button id="introOk" class="modal-button"> OK, Got It ! </button>
    </div>
  </div>

  <header>
    <h1>Image Forensics Multi-Tool v2 [Alpha]</h1>
  </header>

  <div class="sidebar">
    <h2>Tools</h2>
    <div class="controls">
      <button onclick="clearStorage()">Clear Data</button>
      <div style="margin-top: 8px;">
        <input type="checkbox" id="keepDiagram" />
        <label for="keepDiagram" style="cursor: pointer;">Keep Diagram Open</label>
      </div>
    </div>
    <ul id="toolList">
      <li class="tooltip">
        <a href="#" data-src="Modules/clone-detection.html">Clone Detection</a>
        <span class="tooltiptext">Analyzes near-duplicate or repeated regions. Use sliders to adjust thresholds.</span>
      </li>
      <li class="tooltip">
        <a href="#" data-src="Modules/error-level-analysis.html">Error Level Analysis</a>
        <span class="tooltiptext">Examines compression artifacts to detect suspicious edits.</span>
      </li>
      <li class="tooltip">
        <a href="#" data-src="Modules/noise-analysis.html">Noise Analysis</a>
        <span class="tooltiptext">Visualizes image noise. Adjust thresholds to highlight anomalies.</span>
      </li>
      <li class="tooltip">
        <a href="#" data-src="Modules/shading-analysis.html">Shading Analysis</a>
        <span class="tooltiptext">Checks shading consistency across objects. Sliders adjust detection range.</span>
      </li>
      <li class="tooltip">
        <a href="#" data-src="Modules/metadata-analysis.html">Metadata Analysis</a>
        <span class="tooltiptext">Displays EXIF and metadata. Minimal user input needed.</span>
      </li>
      <li class="tooltip">
        <a href="#" data-src="Modules/highlight-edited.html">Highlight Edited Pixels</a>
        <span class="tooltiptext">Highlights likely edited areas. Sliders tweak sensitivity.</span>
      </li>
      <li class="tooltip">
        <a href="#" data-src="Modules/negative-view.html">Negative View</a>
        <span class="tooltiptext">Inverts colors to reveal hidden details. No extra sliders needed.</span>
      </li>
      <li class="tooltip">
        <a href="#" data-src="Modules/heatmap-view.html">Heatmap View</a>
        <span class="tooltiptext">Applies a heatmap to highlight differences. Sliders adjust color scale.</span>
      </li>
      <li class="tooltip">
        <a href="#" data-src="Modules/normal-map.html">Normal Map</a>
        <span class="tooltiptext">Generates a normal map from surface details. Adjust detail settings.</span>
      </li>
      <li class="tooltip">
        <a href="#" data-src="Modules/level-sweep.html">Level Sweep</a>
        <span class="tooltiptext">Sweeps brightness levels to expose anomalies. Adjust range in the tool.</span>
      </li>
      <li class="tooltip">
        <a href="#" data-src="Modules/magnifier.html">Magnifier</a>
        <span class="tooltiptext">Zoom into selected areas. Sliders set magnification level.</span>
      </li>
      <li class="tooltip">
        <a href="#" data-src="Modules/luminance-gradient.html">Luminance Gradient</a>
        <span class="tooltiptext">Displays brightness as a gradient. Adjust scale in the tool.</span>
      </li>
      <li class="tooltip">
        <a href="#" data-src="Modules/principal-component-analysis.html">Principal Component Analysis</a>
        <span class="tooltiptext">Separates color channels to highlight edits. Adjust PCA parameters.</span>
      </li>
      <li class="tooltip">
        <a href="#" data-src="Modules/geo-tags.html">Geo Tags</a>
        <span class="tooltiptext">Extracts embedded geolocation data. Minimal user input.</span>
      </li>
      <li class="tooltip">
        <a href="#" data-src="Modules/thumbnail-analysis.html">Thumbnail Analysis</a>
        <span class="tooltiptext">Compares the main image with its embedded thumbnail for inconsistencies.</span>
      </li>
      <li class="tooltip">
        <a href="#" data-src="Modules/jpeg-analysis.html">JPEG Analysis</a>
        <span class="tooltiptext">Analyzes JPEG blocks and artifacts. Sliders adjust detection threshold.</span>
      </li>
      <li class="tooltip">
        <a href="#" data-src="Modules/string-extraction.html">String Extraction</a>
        <span class="tooltiptext">Searches for textual data in binary. No extra sliders needed.</span>
      </li>
      <!-- Linear De-Blur tool -->
      <li class="tooltip">
        <a href="#" data-src="Modules/directional-unblur.html">Linear De-Blur</a>
        <span class="tooltiptext">This can De-blur an image based on x y offset values, good for focusing fast-moving objects or clarifying blurry license plates.</span>
      </li>
      <!-- Linear De-Blur tool -->
      <li class="tooltip">
        <a href="#" data-src="Modules/pocketknife.html">Pocket-Knife</a>
        <span class="tooltiptext">This is an all Use General Purpose Tool For things Like Brightness, Contrast and Gamma Exposure.</span>
      </li>
    </ul>
  </div>

  <div class="main">
    <iframe id="toolFrame" scrolling="auto"></iframe>
    <iframe
      id="diagramFrame"
      src="https://embed.diagrams.net/?embed=1&ui=atlas&proto=json"
      scrolling="auto">
    </iframe>
  </div>

  <div class="context-menu" id="contextMenu">
    <ul>
      <li onclick="duplicateItem()">Duplicate</li>
      <li onclick="deleteItem()">Delete</li>
    </ul>
  </div>

  <script>
    // Intro Modal logic
    const introModal = document.getElementById('introModal');
    const closeIntro = document.getElementById('closeIntro');
    const introOk = document.getElementById('introOk');
    closeIntro.onclick = () => { introModal.style.display = 'none'; };
    introOk.onclick = () => { introModal.style.display = 'none'; };

    const toolFrame = document.getElementById('toolFrame');
    const diagramFrame = document.getElementById('diagramFrame');
    const contextMenu = document.getElementById('contextMenu');
    const keepDiagramCheckbox = document.getElementById('keepDiagram');

    let currentLink = null;
    let currentModule = null;
    let toolOpen = false;

    // Load 'keep diagram' preference from localStorage
    window.addEventListener('load', () => {
      const lastModule = localStorage.getItem('lastModule');
      const keepDiagramPref = localStorage.getItem('keepDiagram');
      if (keepDiagramPref === 'true') {
        keepDiagramCheckbox.checked = true;
      }
      if (lastModule) {
        toolFrame.src = lastModule;
        currentModule = lastModule;
        openTool();
      }
    });

    // Update localStorage when user toggles "Keep Diagram Open"
    keepDiagramCheckbox.addEventListener('change', () => {
      localStorage.setItem('keepDiagram', keepDiagramCheckbox.checked ? 'true' : 'false');
      if (toolOpen) {
        // If tool is open, re-trigger openTool() logic with new preference
        openTool();
      }
    });

    // Tool links
    document.querySelectorAll('#toolList li a').forEach(link => {
      link.addEventListener('click', e => {
        e.preventDefault();
        const moduleUrl = link.getAttribute('data-src');
        if (moduleUrl === currentModule && toolOpen) {
          closeTool();
          localStorage.removeItem('lastModule');
        } else {
          toolFrame.src = moduleUrl;
          currentModule = moduleUrl;
          openTool();
          localStorage.setItem('lastModule', moduleUrl);
        }
      });
      link.addEventListener('contextmenu', e => {
        e.preventDefault();
        currentLink = link;
        contextMenu.style.left = e.pageX + 'px';
        contextMenu.style.top = e.pageY + 'px';
        contextMenu.style.display = 'block';
      });
    });

    // Hide context menu on outside click
    document.addEventListener('click', () => {
      contextMenu.style.display = 'none';
    });

    function openTool() {
      toolOpen = true;
      if (keepDiagramCheckbox.checked) {
        // Keep diagram visible
        toolFrame.style.height = '50%';
        diagramFrame.style.height = '50%';
      } else {
        // Hide diagram entirely
        toolFrame.style.height = '100%';
        diagramFrame.style.height = '0';
      }
    }

    function closeTool() {
      toolOpen = false;
      currentModule = null;
      toolFrame.style.height = '0';
      // Diagram back to full if no tool is open
      diagramFrame.style.height = '100%';
    }

    function clearStorage() {
      localStorage.clear();
      alert('Local storage cleared.');
    }

    function duplicateItem() {
      if (!currentLink) return;
      const clone = currentLink.parentNode.cloneNode(true);
      currentLink.parentNode.parentNode.insertBefore(clone, currentLink.parentNode.nextSibling);
      contextMenu.style.display = 'none';
    }

    function deleteItem() {
      if (!currentLink) return;
      currentLink.parentNode.remove();
      contextMenu.style.display = 'none';
    }
  </script>
</body>
</html>
